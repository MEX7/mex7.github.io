<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> GO BASE · MEX7</title><meta name="description" content="GO BASE - mex7"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="http://mex7.github.io/atom.xml" title="MEX7"><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="MEX7" type="application/atom+xml">
</head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">MEX7</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>INDEX</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>ARCHIVES</p></a><ul class="shortcut-icons"><a href="https://github.com/AngryPowman" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">GO BASE</h1><div class="post-info">Dec 22, 2017</div><div class="post-content"><h1 id="Excel-读取"><a href="#Excel-读取" class="headerlink" title="Excel 读取"></a>Excel 读取</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(c *echo.Context)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    st, et := util.GetLastWeekPoint()</span><br><span class="line">    dayArrSt := strings.Split(util.Timestamp2String(st), <span class="string">" "</span>)</span><br><span class="line">    dayArrEt := strings.Split(util.Timestamp2String(et), <span class="string">" "</span>)</span><br><span class="line">    <span class="comment">//保存到excel</span></span><br><span class="line">    <span class="comment">//"./xlsx/qos/1" + dayArrSt[0] + "到" + dayArrEt[0] + ".xlsx"</span></span><br><span class="line">    fileName := <span class="string">"1"</span> + dayArrSt[<span class="number">0</span>] + <span class="string">"到"</span> + dayArrEt[<span class="number">0</span>] + <span class="string">".xlsx"</span></span><br><span class="line">    filePath := <span class="string">"./xlsx/qos/"</span> + fileName</span><br><span class="line">    <span class="keyword">if</span> custom.Exist(filePath) &#123;</span><br><span class="line">        f, _ := os.Open(filePath)</span><br><span class="line">        <span class="keyword">defer</span> f.Close()</span><br><span class="line">        b, _ := ioutil.ReadAll(f)</span><br><span class="line">        c.Response().Header().Add(<span class="string">"Content-Type"</span>, <span class="string">"application/vnd.ms-excel"</span>)</span><br><span class="line">        c.Response().Header().Add(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename='"</span>+fileName+<span class="string">"'"</span>)</span><br><span class="line">        c.Response().Header().Add(<span class="string">"Cache-Control"</span>, <span class="string">"max-age=0"</span>)</span><br><span class="line">        c.Response().Write(b)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> handler.JSON(c, handler.MsgErr, <span class="string">"err"</span>, <span class="string">"文件不存在"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> monitorType == <span class="string">"memAvailable"</span> &#123;</span><br><span class="line">   sort.Slice(appResourceTmp, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123; <span class="keyword">return</span> appResourceTmp[i].Value &lt; appResourceTmp[j].Value &#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   sort.Slice(appResourceTmp, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123; <span class="keyword">return</span> appResourceTmp[i].Value &gt; appResourceTmp[j].Value &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="传参和传应用"><a href="#传参和传应用" class="headerlink" title="传参和传应用"></a>传参和传应用</h1><p>map/slice/chan 都是传值, 不是传引用</p>
<p>map/chan 对应指针, 和引用类似</p>
<p>slice 是结构体和指针的混合体</p>
<p>slice 含 values/count/capacity 等信息, 是按值传递</p>
<p>slice 中的 values 是指针, 按值传递</p>
<p>按值传递的 slice 只能修改values指向的数据, 其他都不能修改</p>
<p>以指针或结构体的角度看, 都是值传递!</p>
<h1 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h1><p>如下两种声明int数组的方式有何异同？请说明。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var a []int</span><br><span class="line">a :&#x3D; []int&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>Simple declaration<br>var s []int does not allocate memory and s points to nil, while</p>
<p>s := make([]int, 0) allocates memory and s points to memory to a slice with 0 elements. It means that, to append to a slice, you don’t have to allocate memory first: the nil slice p int[] is enough as a slice to add</p>
<h1 id="channels"><a href="#channels" class="headerlink" title="channels"></a>channels</h1><p>用来同步并发执行函数并提供之间传值交流的机制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i :&#x3D; make(chan int) &#x2F;&#x2F; by default the capacity is 0</span><br><span class="line">s :&#x3D; make(chan string, 3) &#x2F;&#x2F; non-zero capacity</span><br><span class="line"></span><br><span class="line">r :&#x3D; make(&lt;-chan bool) &#x2F;&#x2F; can only read from</span><br><span class="line">w :&#x3D; make(chan&lt;- []os.FileInfo) &#x2F;&#x2F; can only write to</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">func main()&#123;</span><br><span class="line">  addrs :&#x3D; service.GetAddrs(BeijingIDC, 0, service.SourceTypeRedis, &quot;&quot;)</span><br><span class="line">  if len(addrs) &#x3D;&#x3D; 0 &#123;</span><br><span class="line">    return</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  chs :&#x3D; make(chan config.RedisMetric)</span><br><span class="line">  for _, addr :&#x3D; range addrs &#123;</span><br><span class="line">    go func(ch chan config.RedisMetric, address string) &#123;</span><br><span class="line">      ch &lt;- service.GetRedisMetricOfAddr(fmt.Sprintf(&quot;%d_dba&quot;, BeijingIDC), address)</span><br><span class="line">    &#125;(chs, addr)</span><br><span class="line">  &#125;</span><br><span class="line">  result :&#x3D; make([]config.RedisMetric, len(addrs))</span><br><span class="line">  for i, _ :&#x3D; range addrs &#123;</span><br><span class="line">    result[i] &#x3D; &lt;-chs</span><br><span class="line">  &#125;</span><br><span class="line">  close(chs)  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="时间文本转换"><a href="#时间文本转换" class="headerlink" title="时间文本转换"></a>时间文本转换</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getHoursStr</span><span class="params">(time <span class="keyword">int64</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> HoursStr <span class="keyword">string</span></span><br><span class="line">	Hours := <span class="keyword">float32</span>(time) / <span class="number">3600</span></span><br><span class="line">	Days := <span class="keyword">int</span>(Hours / <span class="number">24</span>)</span><br><span class="line">	tmpHours := fmt.Sprintf(<span class="string">"%.1f"</span>, Hours - <span class="keyword">float32</span>(Days)*<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> Days != <span class="number">0</span> &#123;</span><br><span class="line">		HoursStr = HoursStr + strconv.Itoa(Days) + <span class="string">"天"</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> tmpHours == <span class="string">"24.0"</span> &#123;</span><br><span class="line">		tmpHours = <span class="string">"23.9"</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> tmpHours != <span class="string">"0.0"</span> &#123;</span><br><span class="line">		HoursStr = HoursStr + tmpHours + <span class="string">"小时"</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> HoursStr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; IsHostGame 判断当前是否为主机分区</span><br><span class="line">func (r *RoomBase) BatchOnline(rids []uint32) map[uint32]uint32 &#123;</span><br><span class="line">	res :&#x3D; make(map[uint32]uint32, 0)</span><br><span class="line">	for s :&#x3D; 0; s &lt; len(rids); s +&#x3D; 100 &#123;</span><br><span class="line">		e :&#x3D; s + 100</span><br><span class="line">		if s+100 &gt;&#x3D; len(rids) &#123;</span><br><span class="line">			e &#x3D; len(rids)</span><br><span class="line">		&#125;</span><br><span class="line">		tmp, err :&#x3D; model.RoomBaseClient.BatchOnline(context.Background(), &amp;rb.BatchReq&#123;</span><br><span class="line">			Rids: rids[s:e],</span><br><span class="line">		&#125;)</span><br><span class="line">		if err !&#x3D; nil &#123;</span><br><span class="line">			logger.Yami.Info(&quot;BatchOnline&quot;, &quot;err&quot;, err.Error())</span><br><span class="line">			continue</span><br><span class="line">		&#125;</span><br><span class="line">		for k, v :&#x3D; range tmp.OnlineMap &#123;</span><br><span class="line">			res[k] &#x3D; v</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div id="disqus_thread"></div></div><script>var disqus_shortname = 'mex7';
var disqus_identifier = '2017/12/22/2017-12-22-GO-Base/';
var disqus_title = 'GO BASE';
var disqus_url = 'http://mex7.github.io/2017/12/22/2017-12-22-GO-Base/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//mex7.disqus.com/count.js" async></script></main><footer class="footer-container"><div class="paginator"><a href="/2017/12/22/2017-12-22-Golang%E5%B7%A5%E5%85%B7%E7%AE%B1/" class="prev">PREV</a><a href="/2017/08/01/2017-08-01-Elasticsearch/" class="next">NEXT</a></div><div class="copyright"><p>© 2014 - 2021 <a href="http://mex7.github.io">mex7</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"MEX",'auto');ga('send','pageview');</script></body></html>